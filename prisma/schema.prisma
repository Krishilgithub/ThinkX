// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Teacher Model - Only teachers can create courses
model Teacher {
  id     String  @id @default(uuid())
  email  String  @unique
  name   String
  avatar String?
  bio    String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  courses Course[]
}

// Course Model - Contains all video generation parameters
model Course {
  id String @id @default(uuid())

  // Basic Info
  title       String
  subject     String // e.g., "Mathematics", "Science", "History"
  topic       String // Specific topic within the subject
  description String? @db.Text

  // Video Generation Parameters
  duration Int // Duration in seconds
  avatarId String // HeyGen avatar ID
  voiceId  String // HeyGen voice ID

  // Target Audience
  targetAudience String // e.g., "Students", "Professionals", "Beginners"
  ageGroup       String // e.g., "10-15", "16-20", "Adult"

  // Style & Tone
  style    String // e.g., "Professional", "Casual", "Educational"
  tone     String // e.g., "Formal", "Friendly", "Motivational"
  keywords String[] // Array of keywords for content generation

  // Metadata
  thumbnail String?
  status    String  @default("DRAFT") // DRAFT, PUBLISHED, ARCHIVED

  // Teacher Relation
  teacherId String
  teacher   Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  // Course Content
  chapters Chapter[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([teacherId])
  @@index([status])
}

// Chapter Model - Individual lessons/modules within a course
model Chapter {
  id          String  @id @default(uuid())
  title       String
  description String? @db.Text
  orderIndex  Int     @default(0)

  // Video Information
  videoUrl  String? // Generated video URL from HeyGen
  thumbnail String?
  duration  Int? // Actual duration in seconds
  script    String? @db.Text // Generated script for the video

  // Video Generation Status
  status      String  @default("DRAFT") // DRAFT, GENERATING, COMPLETED, FAILED
  heygenJobId String? // HeyGen video generation job ID

  // Course Relation
  courseId String
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Video Generation Jobs
  jobs VideoJob[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([courseId])
  @@index([status])
}

// VideoJob Model - Track video generation progress
model VideoJob {
  id String @id @default(uuid())

  chapterId String
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  heygenJobId String? // HeyGen API job ID
  status      String  @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  progress    Int     @default(0) // 0 to 100
  error       String? @db.Text

  // Generation Parameters (snapshot for this job)
  avatarId String?
  voiceId  String?
  script   String? @db.Text

  startedAt   DateTime  @default(now())
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([chapterId])
  @@index([status])
}
